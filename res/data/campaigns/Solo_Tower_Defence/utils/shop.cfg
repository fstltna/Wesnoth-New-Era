#define TD_SHOP
	[event]
		name=start
		[set_menu_item]
			id=mi_tower_shop
			description="Upgrade this Tower!"
			[filter_location]
				terrain=Xu
			[/filter_location]
			[show_if]
				[have_unit]
					x,y=$x1,$y1
					side=3,5,7,9
					canrecruit=no
					count=1
				[/have_unit]
			[/show_if]
			[command]
				{VARIABLE done no}
				[while]
					[variable]
						name=done
						equals=no
					[/variable]
					[do]
						[redraw]
						[/redraw]
						[store_gold]
							side=1
							variable=gold
						[/store_gold]
						[message]
							speaker=narrator
							message="What should I upgrade? Gold: $gold"
							[option]
								message="Nothing"
								[command]
									{VARIABLE done yes}
								[/command]
							[/option]
							[option]
								message="Damage Upgrades"
								[command]
									[message]
									speaker=narrator
									message="Damage Upgrades"
									[option]
										message="(back)"
										[command]
										[/command]
									[/option]
									[option]
										message="Add 1 Damage (Costs: 10)"
										[command]
											[if]
												[variable]
													name=gold
													greater_than_equal_to=10
												[/variable]
												[then]
													[gold]
														side=1
														amount=-10
													[/gold]
													[object]
														silent=yes
														[filter]
															x,y=$x1,$y1
														[/filter]
														[effect]
															apply_to=attack
															range=ranged
															increase_damage=1
														[/effect]
													[/object]
													[sound]
														name=club.ogg
													[/sound]
												[/then]
												[else]
													[message]
														speaker=unit
														side_for=$side_number
														message="Hmm... Not enough money..."
													[/message]
												[/else]
											[/if]
										[/command]
									[/option]
									[option]
										message="Add 5 Damage (Costs: 50)"
										[command]
											[if]
												[variable]
													name=gold
													greater_than_equal_to=50
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[object]
														silent=yes
														[filter]
															x,y=$x1,$y1
														[/filter]
														[effect]
															apply_to=attack
															range=ranged
															increase_damage=5
														[/effect]
													[/object]
													[sound]
														name=club.ogg
													[/sound]
												[/then]
												[else]
													[message]
														speaker=unit
														side_for=$side_number
														message="Hmm... Not enough money..."
													[/message]
												[/else]
											[/if]
										[/command]
									[/option]
									[option]
										message="Add 10 Damage (Costs: 100)"
										[command]
											[if]
												[variable]
													name=gold
													greater_than_equal_to=100
												[/variable]
												[then]
													[gold]
														side=1
														amount=-100
													[/gold]
													[object]
														silent=yes
														[filter]
															x,y=$x1,$y1
														[/filter]
														[effect]
															apply_to=attack
															range=ranged
															increase_damage=10
														[/effect]
													[/object]
													[sound]
														name=club.ogg
													[/sound]
												[/then]
												[else]
													[message]
														speaker=unit
														side_for=$side_number
														message="Hmm... Not enough money..."
													[/message]
												[/else]
											[/if]
										[/command]
									[/option]
									[option]
										message="Add 50 Damage (Costs: 500)"
										[command]
											[if]
												[variable]
													name=gold
													greater_than_equal_to=500
												[/variable]
												[then]
													[gold]
														side=1
														amount=-500
													[/gold]
													[object]
														silent=yes
														[filter]
															x,y=$x1,$y1
														[/filter]
														[effect]
															apply_to=attack
															range=ranged
															increase_damage=50
														[/effect]
													[/object]
													[sound]
														name=club.ogg
													[/sound]
												[/then]
												[else]
													[message]
														speaker=unit
														side_for=$side_number
														message="Hmm... Not enough money..."
													[/message]
												[/else]
											[/if]
										[/command]
									[/option]
									[option]
										message="Add 100 Damage (Costs: 1000)"
										[command]
											[if]
												[variable]
													name=gold
													greater_than_equal_to=1000
												[/variable]
												[then]
													[gold]
														side=1
														amount=-1000
													[/gold]
													[object]
														silent=yes
														[filter]
															x,y=$x1,$y1
														[/filter]
														[effect]
															apply_to=attack
															range=ranged
															increase_damage=100
														[/effect]
													[/object]
													[sound]
														name=club.ogg
													[/sound]
												[/then]
												[else]
													[message]
														speaker=unit
														side_for=$side_number
														message="Hmm... Not enough money..."
													[/message]
												[/else]
											[/if]
										[/command]
									[/option]
									
									[/message]
								[/command]
							[/option]
							[option]
								message="Attack Upgrades"
								[command]
								
								[message]
									speaker=narrator
									message="Attack Upgrades"
								[option]
									message="(back)"
									[command]
									[/command]
								[/option]
								[option]
									message="Add 1 attack (Costs: 100)"
									[command]
										[if]
											[variable]
												name=gold
												greater_than_equal_to=100
											[/variable]
											[then]
												[gold]
													side=1
													amount=-100
												[/gold]
												[object]
													silent=yes
													[filter]
														x,y=$x1,$y1
													[/filter]
													[effect]
														apply_to=attack
														range=ranged
														increase_attacks=1
													[/effect]
												[/object]
												[sound]
													name=axe.ogg
												[/sound]
											[/then]
											[else]
												[message]
													speaker=unit
													side_for=$side_number
													message="Hmm... Not enough money..."
												[/message]
											[/else]
										[/if]
									[/command]
								[/option]
								[option]
									message="Add 5 attacks (Costs: 500)"
									[command]
										[if]
											[variable]
												name=gold
												greater_than_equal_to=500
											[/variable]
											[then]
												[gold]
													side=1
													amount=-500
												[/gold]
												[object]
													silent=yes
													[filter]
														x,y=$x1,$y1
													[/filter]
													[effect]
														apply_to=attack
														range=ranged
														increase_attacks=5
													[/effect]
												[/object]
												[sound]
													name=axe.ogg
												[/sound]
											[/then]
											[else]
												[message]
													speaker=unit
													side_for=$side_number
													message="Hmm... Not enough money..."
												[/message]
											[/else]
										[/if]
									[/command]
								[/option]
								[option]
									message="Add 10 attacks (Costs: 1000)"
									[command]
										[if]
											[variable]
												name=gold
												greater_than_equal_to=1000
											[/variable]
											[then]
												[gold]
													side=1
													amount=-1000
												[/gold]
												[object]
													silent=yes
													[filter]
														x,y=$x1,$y1
													[/filter]
													[effect]
														apply_to=attack
														range=ranged
														increase_attacks=10
													[/effect]
												[/object]
												[sound]
													name=axe.ogg
												[/sound]
											[/then]
											[else]
												[message]
													speaker=unit
													side_for=$side_number
													message="Hmm... Not enough money..."
												[/message]
											[/else]
										[/if]
									[/command]
								[/option]
								[/message]
								
								
								[/command]
							[/option]

							[option]
								message="Other Upgrades"
								[command]
									[message]
										speaker=narrator
										message="Other Upgrades"
										[option]
											message="(back)"
											[command]
											[/command]
										[/option]
										[option]
											message="Normal Arrows (Costs: 10)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=10
													[/variable]
													[then]
														[gold]
															side=1
															amount=-10
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																set_type=pierce
															[/effect]
														[/object]
														[sound]
															name=bow.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Sharp Arrows (Costs: 100)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=100
													[/variable]
													[then]
														[gold]
															side=1
															amount=-100
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																set_type=pierce,blade
															[/effect]
														[/object]
														[sound]
															name=throwing-knife.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Siege Arrows (Costs: 100)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=100
													[/variable]
													[then]
														[gold]
															side=1
															amount=-100
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																set_type=pierce,impact
															[/effect]
														[/object]
														[sound]
															name=bow-puny.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Magical Arrows (Costs: 100)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=100
													[/variable]
													[then]
														[gold]
															side=1
															amount=-100
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																set_type=pierce,arcane
															[/effect]
														[/object]
														[sound]
															name=magic-missile-1.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Ice Arrows (Costs: 100)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=100
													[/variable]
													[then]
														[gold]
															side=1
															amount=-100
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																set_type=pierce,cold
															[/effect]
														[/object]
														[sound]
															name=magic-dark-miss.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Fire Arrows (Costs: 100)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=100
													[/variable]
													[then]
														[gold]
															side=1
															amount=-100
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																set_type=pierce,fire
															[/effect]
														[/object]
														[sound]
															name=crossbow-fire.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Slow (Costs: 100)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=100
													[/variable]
													[then]
														[gold]
															side=1
															amount=-100
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																[set_specials]
																	{WEAPON_SPECIAL_SLOW}
																[/set_specials]
															[/effect]
														[/object]
														[sound]
															name=slowed.wav
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Marksman (Costs: 250)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=250
													[/variable]
													[then]
														[gold]
															side=1
															amount=-250
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																[set_specials]
																	{WEAPON_SPECIAL_MARKSMAN}
																[/set_specials]
															[/effect]
														[/object]
														[sound]
															name=bow.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Poison (Costs: 500)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=500
													[/variable]
													[then]
														[gold]
															side=1
															amount=-500
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=attack
																range=ranged
																[set_specials]
																	{WEAPON_SPECIAL_POISON}
																[/set_specials]
															[/effect]
														[/object]
														[sound]
															name=poison.ogg
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
										[option]
											message="Nightstalk (Costs: 500)"
											[command]
												[if]
													[variable]
														name=gold
														greater_than_equal_to=500
													[/variable]
													[then]
														[gold]
															side=1
															amount=-500
														[/gold]
														[object]
															silent=yes
															[filter]
																x,y=$x1,$y1
															[/filter]
															[effect]
																apply_to=new_ability
																[abilities]
																	{ABILITY_NIGHTSTALK}
																[/abilities]
															[/effect]
														[/object]
														[sound]
															name=wail-sml.wav
														[/sound]
													[/then]
													[else]
														[message]
															speaker=unit
															side_for=$side_number
															message="Hmm... Not enough money..."
														[/message]
													[/else]
												[/if]
											[/command]
										[/option]
									[/message]
								[/command]
							[/option]

						[/message]
					[/do]
				[/while]
				{CLEAR_VARIABLE done}
			[/command]
		[/set_menu_item]
		[set_menu_item]
			id=mi_resource_shop
			description="Make a House!"
			[command]
				{VARIABLE done no}
				[while]
					[variable]
						name=done
						equals=no
					[/variable]
					[do]
						[redraw]
						[/redraw]
						[store_gold]
							side=1
							variable=gold
						[/store_gold]
						[message]
							speaker=narrator
							message="Make a house? 
Gold: $gold 
Houses: $houses_$side_number / 10."
							[option]
								message="No thanks."
								[command]
									{VARIABLE done yes}
								[/command]
							[/option]
							[option]
								message="Buy House. (Costs: 50)"
								[command]
									[if]
										[variable]
											name=gold
											greater_than_equal_to=50
										[/variable]
										[then]
											[if]
												[variable]
													name=houses_1
													equals=10
												[/variable]
												[then]
													[message]
														speaker=narrator
														message="I can't buy anymore..."
													[/message]
													[sound]
														name=groan.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=9
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,4
													[/terrain]
													[capture_village]
														side=1
														x,y=27,4
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=8
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,5
													[/terrain]
													[capture_village]
														side=1
														x,y=27,5
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=7
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,6
													[/terrain]
													[capture_village]
														side=1
														x,y=27,6
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=6
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,7
													[/terrain]
													[capture_village]
														side=1
														x,y=27,7
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=5
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,8
													[/terrain]
													[capture_village]
														side=1
														x,y=27,8
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=4
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,9
													[/terrain]
													[capture_village]
														side=1
														x,y=27,9
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=3
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,10
													[/terrain]
													[capture_village]
														side=1
														x,y=27,10
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=2
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,11
													[/terrain]
													[capture_village]
														side=1
														x,y=27,11
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=1
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,12
													[/terrain]
													[capture_village]
														side=1
														x,y=27,12
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
											[if]
												[variable]
													name=houses_1
													equals=0
												[/variable]
												[then]
													[gold]
														side=1
														amount=-50
													[/gold]
													[set_variable]
														name=houses_1
														add=1
													[/set_variable]
													[terrain]
														terrain=Gg^Ve
														x,y=27,13
													[/terrain]
													[capture_village]
														side=1
														x,y=27,13
													[/capture_village]
													[sound]
														name=staff.wav
													[/sound]
												[/then]
											[/if]
										[/then]
										[else]
											[message]
												speaker=unit
												side_for=$side_number
												message="Hmm... Not enough money..."
											[/message]
										[/else]
									[/if]
								[/command]
							[/option]
						[/message]
					[/do]
				[/while]
			[/command]
		[/set_menu_item]
	[/event]
#enddef
